@using HomeBook.Client
@using HomeBook.Frontend.Abstractions.Contracts
@using HomeBook.Frontend.Models.Setup

@inject ILocalizationProvider Loc
@inject ISetupService SetupService
@inject BackendClient BackendClient
@inject IDialogService DialogService

<MudCard Class="frosted-b3 mud-elevation-6">

    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h4">Check Server Connection</MudText>
        </CardHeaderContent>
    </MudCardHeader>

    <MudCardContent>

        @if (_isLoading)
        {
            <div class="relative d-flex flex-grow-1 flex-wrap flex-column justify-center align-center">
                <MudProgressLinear Color="Color.Primary"
                                   Indeterminate="true"
                                   Class="my-7"/>
            </div>
        }

        @if (!_isLoading)
        {
            @if (_licensesAccepted)
            {
                <UiCountdownAlert Class="mt-3"
                                  Duration="TimeSpan.FromSeconds(5)"
                                  OnFinished="async () => await OnCountdownFinishedAsync()"
                                  Severity="Severity.Info">
                    Licenses are already accepted.
                </UiCountdownAlert>
            }

            @if (!string.IsNullOrEmpty(_errorMessage))
            {
                <MudAlert Class="mt-3"
                          Severity="Severity.Error">
                    @_errorMessage
                </MudAlert>

                <MudButton Color="Color.Primary"
                           Variant="Variant.Filled"
                           Class="mt-3"
                           OnClick="async () => await LoadLicensesAsync()">
                    Retry
                </MudButton>
            }

            <MudButton Color="Color.Secondary"
                       Variant="Variant.Filled"
                       Class="mt-3"
                       StartIcon="@Icons.Material.TwoTone.TextSnippet"
                       OnClick="async () => await OpenLicensesDialogAsync()">
                Show Licenses
            </MudButton>

            @if (!_licensesAccepted)
            {
                <MudButton Color="Color.Primary"
                           Variant="Variant.Filled"
                           Class="ms-3 mt-3"
                           StartIcon="@Icons.Material.TwoTone.Check"
                           OnClick="async () => await StepSuccessAsync()">
                    Accept and Continue
                </MudButton>
            }
        }

    </MudCardContent>

</MudCard>

@using HomeBook.Frontend.Core.Models.Widgets
@using HomeBook.Frontend.Modules.Abstractions

@page "/"

<UiPageTitle>Home</UiPageTitle>

<MudButton Variant="Variant.Filled"
           Class="ma-5"
           Color="Color.Primary"
           OnClick="@(() => OpenDrawer())">Start
</MudButton>

<MudDropContainer T="WidgetConfiguration" DraggingClass="mud-alert-text-warning"
                  ItemDraggingClass="mud-alert-text-warning"
                  Items="_items" ItemsSelector="@((item, dropzone) => item.Identifier == dropzone)"
                  NoDropClass="mud-border-error" ItemDropped="ItemUpdated" Class="d-flex flex-wrap flex-grow-1">
    <ChildContent>

        <MudDropZone T="WidgetConfiguration" Identifier="Air Zone 1"
                     Class="rounded-lg border-2 border-dashed mud-border-lines-default pa-6 ma-8 flex-grow-1">
            <MudText Typo="Typo.h6" Class="mb-4">Air Zone 1</MudText>
        </MudDropZone>
        <MudDropZone T="WidgetConfiguration" Identifier="Air Zone 2"
                     Class="rounded-lg border-2 border-dashed mud-border-lines-default pa-6 ma-8 flex-grow-1">
            <MudText Typo="Typo.h6" Class="mb-4">Air Zone 2</MudText>
        </MudDropZone>
        <MudDropZone T="WidgetConfiguration" Identifier="Danger Zone" DraggingClass="mud-alert-text-error"
                     ItemDraggingClass="mud-alert-text-error" CanDrop="@((item) => item.Team == "RED")"
                     Class="rounded-lg border-2 border-dashed mud-border-lines-default pa-6 ma-8">
            <MudText Typo="Typo.h6" Class="mb-4">Danger Zone</MudText>
        </MudDropZone>

        <MudDrawer Anchor="Anchor.End"
                   Color="Color.Default"
                   @bind-Open="@_open"
                   Elevation="1"
                   Variant="@DrawerVariant.Temporary"
                   OverlayAutoClose="true"
                   Overlay="false"
                   Width="var(--ui-widget-drawer-width)"
                   Class="frosted mud-elevation-10">

            <MudDrawerHeader>
                <MudText Typo="Typo.h6">Widgets</MudText>
            </MudDrawerHeader>

            <UiWidgetSelector/>

        </MudDrawer>

    </ChildContent>

    <ItemRenderer>
        <UiWidgetContainer Size="@context.Size">
            <DynamicComponent Type="context.WidgetType"
                              Parameters="context.Parameters"/>
        </UiWidgetContainer>
    </ItemRenderer>

</MudDropContainer>

@code
{
    private bool _open;

    private void OpenDrawer()
    {
        _open = true;
    }

    private void ItemUpdated(MudItemDropInfo<WidgetConfiguration> dropItem)
    {
        dropItem.Item.Identifier = dropItem.DropzoneIdentifier;
    }

    private List<WidgetConfiguration> _items = new()
    {
        new WidgetConfiguration(typeof(Module.PlatformInfo.Widgets.VersionWidget), WidgetSize.Size2x1, new Dictionary<string, object>() { { "IsPreview", true } }, "Enterprise", "BLUE"),
        new WidgetConfiguration(typeof(Module.PlatformInfo.Widgets.VersionWidget), WidgetSize.Size2x1, new Dictionary<string, object>() { { "IsPreview", true } }, "Enterprise", "BLUE"),
        new WidgetConfiguration(typeof(Module.PlatformInfo.Widgets.VersionWidget), WidgetSize.Size2x1, new Dictionary<string, object>() { { "IsPreview", false } }, "Enterprise", "RED"),
        new WidgetConfiguration(typeof(Module.PlatformInfo.Widgets.VersionWidget), WidgetSize.Size2x1, new Dictionary<string, object>() { { "IsPreview", false } }, "Enterprise", "RED"),
    };
}

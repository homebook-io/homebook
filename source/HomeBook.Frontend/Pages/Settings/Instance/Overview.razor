@page "/Settings/Instance"

@using HomeBook.Client
@using HomeBook.Frontend.Abstractions.Contracts
@using HomeBook.Frontend.Core.Icons
@using HomeBook.Frontend.Core.Models.Setup
@using HomeBook.Frontend.UI.Resources
@using Microsoft.Extensions.Localization

@inject IStringLocalizer<LocalizationStrings> Loc
@inject ISnackbar Snackbar
@inject IInstanceManagementProvider InstanceManagementProvider
@inject IJsLocalStorageProvider JsLocalStorageProvider
@inject BackendClient BackendClient

<MudContainer>

    <MudGrid>

        <MudItem xs="12" sm="12" md="4" lg="3" xl="3" xxl="3">

            <SettingsNavMenu/>

        </MudItem>

        <MudItem xs="12" sm="12" md="8" lg="9" xl="9" xxl="9">

            <MudForm @ref="_form"
                     Model="_configurationModel"
                     @bind-IsValid="_isValid">

                <MudCard>

                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h5">
                                @Loc[nameof(LocalizationStrings.Settings_Instance_PageTitle)]
                            </MudText>
                            <MudText Typo="Typo.caption">
                                @Loc[nameof(LocalizationStrings.Settings_Instance_PageCaption)]
                            </MudText>
                        </CardHeaderContent>
                    </MudCardHeader>

                    <MudCardContent Class="pa-0">

                        <UiSettingsItem Icon="@HomeBookIcons.Icons8.Windows11.Filled.Tag"
                                        IconHexColor="var(--hb-settings-color-instance-name)"
                                        Title="@Loc[nameof(LocalizationStrings.Settings_Instance_InstanceName_Title)]"
                                        Caption="@Loc[nameof(LocalizationStrings.Settings_Instance_InstanceName_Caption)]">
                            <MudTextField @bind-Value="_configurationModel.InstanceName"
                                          Margin="Margin.Dense"
                                          Variant="Variant.Outlined"
                                          For="@(() => _configurationModel.InstanceName)"
                                          Required="true"
                                          Clearable="true"
                                          Immediate="true"/>
                        </UiSettingsItem>

                        <MudDivider/>

                        <UiSettingsItem Icon="@HomeBookIcons.Icons8.Windows11.Filled.Translation"
                                        IconHexColor="var(--hb-settings-color-default-language)"
                                        Title="@Loc[nameof(LocalizationStrings.Settings_Instance_InstanceDefaultLocale_Title)]"
                                        Caption="@Loc[nameof(LocalizationStrings.Settings_Instance_InstanceDefaultLocale_Caption)]">
                            <MudSelect @bind-Value="_configurationModel.InstanceDefaultLocale"
                                       Variant="Variant.Outlined"
                                       Margin="Margin.Dense"
                                       Dense="true"
                                       For="@(() => _configurationModel.InstanceDefaultLocale)"
                                       Required="true"
                                       Clearable="true">
                                @foreach (LanguageViewModel language in _availableLanguages)
                                {
                                    <MudSelectItem Value="language.Key">@language.DisplayName</MudSelectItem>
                                }
                            </MudSelect>
                        </UiSettingsItem>

                    </MudCardContent>

                    <MudCardActions Class="justify-end">
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Primary"
                                   OnClick="UpdateInstanceConfigurationAsync"
                                   Disabled="@(!_isValid || _isLoading)">
                            @if (_isLoading)
                            {
                                <MudProgressCircular Size="Size.Small"
                                                     Indeterminate="true"
                                                     Class="mr-2"/>
                            }
                            @Loc[nameof(LocalizationStrings.Settings_Instance_SaveChanges_Button)]
                        </MudButton>
                    </MudCardActions>

                </MudCard>

            </MudForm>

        </MudItem>

    </MudGrid>

</MudContainer>
